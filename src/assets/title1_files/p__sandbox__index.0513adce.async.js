(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[29],{"/TPw":function(e,t,o){"use strict";var n=o("fbTi"),i=o("mZ4U");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(o("scpF")),c=i(o("O/V9")),r=i(o("8aBX")),d=i(o("43Yg")),s=i(o("/tCh")),l=i(o("cDcd")),h=n(o("zMAO")),p="current",m="ant-render-id-",u="data-ant-render-component";o("h0yC");var f=function(){function e(){var t=this;(0,d.default)(this,e),this.iframe=null,this.iframeHeight=0,this.observer=null,this.currentSchemaName=null,this.currentSchemaOffsetTop=0,this.currentSchemaHeight=0,this.currentComponentId=null,this.viewHeight=0,this.loaded=!1,this.currentInsertComponentId=null,this.scrollTarget={needActiveSchema:!0,componentId:null,schemaName:null},this.boxConfig={},this.currentBoxID=null,this.componentTools=null,this.componentDropHolder=null,"undefined"!==typeof MutationObserver&&(window.$("html").css({overflow:"hidden"}),this.iframe=window.$("#viewer"),this.iframe.on("load",function(){t.iframeOnload()}),this.observer=new MutationObserver(function(){t.calcHeight()}),this.viewHeight=document.documentElement.clientHeight)}return(0,s.default)(e,[{key:"initPostMessage",value:function(){var e=this;window.addEventListener("message",function(t){var o=t.data,n=o.eventType;if(t.origin===(0,h.getDefaultUrl)())switch(n){case h.EventType.RELOAD:var i=o.data;e.render(i.html,i.schemaName,i.componentId,i.needActiveSchema);break;case h.EventType.CANCEL_SELECT:e.cancelSelect();break;case h.EventType.HIDE_DROP_COMPONENT_HOLDER:e.hideDropComponentPlaceHolder.call(e);break;case h.EventType.SHOW_DROP_COMPONENT_HOLDER:var a=o.data;e.showDropComponentPlaceHolder.call(e,a);break;default:break}},!1),h.default.ready()}},{key:"hideComponentTool",value:function(){this.componentTools.css({visibility:"hidden"}).find("div").css({visibility:"hidden"})}},{key:"iframeOnload",value:function(){var e=this;this.loaded=!0;var t=this;this.doc.on("mouseenter","div["+u+"]",function(e){var o=window.$(e.currentTarget),n=o.offset(),i=o.outerHeight(),a=o.data("box")||o.parent().data("box"),c=o.parents(".fengdie-components").length;if(t.componentTools&&c&&!a&&!t.componentDropHolder){t.componentTools.css({visibility:"visible",left:n.left,width:o.outerWidth(),height:i,transform:"translateY("+n.top+"px)"}).find("#yunfengdie-component-tools-item-top").css({visibility:o.outerHeight()<40?"hidden":"visible"}).end().find("#yunfengdie-component-tools-item-bottom").css({visibility:"visible"});var r=o.data("schema")?o.parent():o,d=(r.attr("id")||"").replace(m,"");t.currentInsertComponentId=d,h.default.hoverSchema({componentId:d,height:i,top:n.top})}e.preventDefault(),e.stopPropagation()}).on("mouseleave","body",function(e){t.hideComponentTool()}).on("click","#yunfengdie-component-tools-item-top",function(){t.deActiveBox(),t.hideComponentTool(),t.showDropComponentPlaceHolder({componentId:t.currentInsertComponentId,type:"before"}),h.default.showNewComponentPanel(t.currentInsertComponentId,"before")}).on("click","#yunfengdie-component-tools-item-bottom",function(){t.deActiveBox(),t.hideComponentTool(),t.showDropComponentPlaceHolder({componentId:t.currentInsertComponentId,type:"after"}),h.default.showNewComponentPanel(t.currentInsertComponentId,"after")}).on("click","[data-schema]",function(e){t.hideDropComponentPlaceHolder(),t.deActiveBox(),t.activeSelected(window.$(e.currentTarget),{type:"schema"}),e.preventDefault(),e.stopPropagation()}).on("click","body",function(){t.deActiveBox()}).find("a").click(function(o){"object"===window.$(e).data("type")&&t.activeSelected(window.$(e)),o.preventDefault()}),this.injectComponentTools(),this.doc.find('[data-type="array"]').each(function(e){var t=e.parentNode;e.dataset?(t.dataset.schema=e.dataset.schema,t.dataset.type="object",t.dataset.desc=e.dataset.desc):(t.setAttribute("data-schema",e.getAttribute("data-schema")),t.setAttribute("data-type","object"),t.setAttribute("data-desc",e.getAttribute("data-desc")))}).end().find("[data-type]").each(function(e,t){var o=window.$(t);"fixed"!==o.css("position")&&(o.css("position","relative"),"inline"===o.css("display")&&o.css("display","block"))}),setTimeout(function(){e.calcHeight(),e.box(),e.showEmptyComponentTips(),e.scrollToTarget()},200),"undefined"!==typeof MutationObserver&&this.observer&&(this.observer.disconnect(),this.observer.observe(this.doc[0].body,{childList:!0,subtree:!0,attributes:!0})),t.initComponentList()}},{key:"scrollToTarget",value:function(){var e=this.currentComponentId,t=this.currentSchemaName,o=this.currentSchemaOffsetTop,n=this.currentSchemaHeight,i=this.scrollTarget,a=i.componentId,c=i.schemaName,r=i.needActiveSchema;if(a||c){var d=this.doc.find("#".concat(m).concat(a)),s=null;if(d.length){if(s=c?d.find('div[data-schema="'+c+'"]'):d.find("div[data-schema]").eq(0),s.length){var l=s.offset().top,p=s.outerHeight();a!==e||c!==t||l!==o?(!1!==r&&this.activeSelected(s),h.default.loadDone({needScroll:!0,top:l})):p!==n&&(this.currentSchemaHeight=p,h.default.activeComponentHeightChange({height:p}))}}else e&&this.cancelSelect()}}},{key:"showEmptyComponentTips",value:function(){var e=this,t=window.$(".fengdie-components",this.doc),o=t.children().length,n=!1;if(0!==o&&0!==t.outerHeight()||(n=!0),n){var i=window.$('<div id="fengdie-components-empty-tips" />');i.html('<img width="180" height="180" src="https://gw.alipayobjects.com/zos/rmsportal/vCbMpJlWAzfHGqOtzFCD.png" /><div><a href="javascript:;">\u8bf7\u6dfb\u52a0\u7ec4\u4ef6</a></div>'),t.append(i),i.click(function(){e.showDropComponentPlaceHolder({componentId:null,type:"before"}),h.default.showNewComponentPanel(null,"after")})}}},{key:"calcHeight",value:function(){var e=this.doc.find("body")[0].scrollHeight,t=Math.max(this.viewHeight,e);this.iframe.css({height:t}),this.iframeHeight!==t&&(this.iframeHeight=t,h.default.changeHeight({height:t}))}},{key:"hasFdComponents",value:function(){return this.doc.find(".fengdie-components").length>0}},{key:"injectComponentTools",value:function(){if(!window.$("#yunfengdie-component-tools").length||!this.componentTools){var e=window.$('<div id="yunfengdie-component-tools" />');this.hasFdComponents()&&e.html('<div id="yunfengdie-component-tools-item-top"></div><div id="yunfengdie-component-tools-item-bottom"></div>'),this.doc.find("body").append(e),this.componentTools=e}}},{key:"box",value:function(){var e=this;e.doc.find("[data-box]").resizable({handles:"all"}).draggable({}).on("resizestart",function(t,o){e.initBox(t.target),e.currentBoxID=o.helper.data("box")}).on("resizestop",function(t,o){e.resizeBox(o)}).on("dragstart",function(t,o){e.initBox(t.target),e.currentBoxID=o.helper.data("box"),e.activeSelected(window.$(t.target).closest("[data-type]")),e.activeBox()}).on("dragstop",function(t,o){e.dragBox(o)}).on("click",function(t){e.currentBoxID=window.$(t.target).data("box"),t.stopPropagation(),t.preventDefault(),e.activeSelected(window.$(t.target).closest("[data-type]")),e.activeBox()}),e.activeBox()}},{key:"initBox",value:function(e){var t=window.$(e).data("box");this.boxConfig[t]&&this.boxConfig[t].ratio||(this.boxConfig[t]={ratio:this.getElPosArr(e,["width","height","left","top"])})}},{key:"getElPosArr",value:function(e,t){var o=this,n=[];return t.forEach(function(t){n.push(o.getElPos(e,t))}),n}},{key:"getElPos",value:function(e,t){var o=parseFloat(e.style[t]),n=window.$(e).css(t);return n=parseFloat(n),{px:n,per:o}}},{key:"resizeBox",value:function(e){var t=e.element.data("box"),o=e.element.data("schema"),n=e.element.data("moduleId"),i=e.element.data("componentName"),a=e.element.data("private"),c=this.boxConfig[t],r=c.ratio,d=e.size;if(c.width=d.width*r[0].per/r[0].px||.1,c.height=d.height*r[1].per/r[1].px||.1,this.changePosition(e.position,c),!o){var s=e.helper.closest("[".concat(u,"]"));o=e.helper.closest("[data-schema]").data("schema"),n=s.attr("id").replace("ant-render-id-",""),i=s.data("antRenderComponent"),a=s.data("private")}this.savePos(t,{schemaName:o,componentId:n,componentName:i,isPrivate:a})}},{key:"savePos",value:function(e,t){var o=Object.assign({},this.boxConfig[e]);delete o.ratio,h.default.savePos({uid:e,schema:t,position:o})}},{key:"changePosition",value:function(e,t){var o=t.ratio;t.left=e.left*o[2].per/o[2].px||.1,t.top=e.top*o[3].per/o[3].px||.1}},{key:"activeBox",value:function(){if(this.currentBoxID){var e=window.$(this.doc);window.$(".".concat(p),e).removeClass(p),window.$("[data-box=".concat(this.currentBoxID,"]"),e).addClass(p)}}},{key:"deActiveBox",value:function(){var e=window.$(this.doc);window.$(".".concat(p),e).removeClass(p)}},{key:"activeSelected",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"schema"},o=this.doc,n="schema"===t.type?e.parents("[".concat(u,"]")):e,i=n.attr("id")?n.attr("id").replace(m,""):null,a=n.data("ant-render-component"),c=n.data("private"),r=e.data("schema"),d=e.offset().top;if(this.hideDropComponentPlaceHolder(),e.length&&(i!==this.currentComponentId||r!==this.currentSchemaName||this.currentSchemaOffsetTop!==d)&&(this.currentComponentId=i,this.currentSchemaName=r,this.currentSchemaOffsetTop=e.offset().top,this.currentSchemaHeight=e.outerHeight(),h.default.activeSelectedSchema({schemaName:r||void 0,componentId:i||void 0,componentName:a||void 0,isPrivate:c||!1,meta:{top:e.offset().top,height:e.outerHeight()}}),i)){var s=[],l=window.$(".fengdie-components",o).children("[".concat(u,"]"));l.each(function(e,t){t=window.$(t),s.push({uid:t.attr("id").replace(m,""),name:t.data("ant-render-component"),meta:{top:t.offset().top,height:t.outerHeight()}})}),h.default.activeSelectedInitMM({componentList:s,componentId:i})}}},{key:"dragBox",value:function(e){var t=e.position,o=e.helper.data("box"),n=e.helper.data("schema"),i=e.helper.data("moduleId"),a=e.helper.data("componentName"),c=e.helper.data("private"),r=this.boxConfig[o];if(this.changePosition(t,r),!n){var d=e.helper.closest("[".concat(u,"]"));n=e.helper.closest("[data-schema]").data("schema"),i=d.attr("id").replace("ant-render-id-",""),a=d.data("antRenderComponent"),c=d.data("private")}this.savePos(o,{schemaName:n||void 0,componentId:i||void 0,componentName:a||void 0,isPrivate:c})}},{key:"cancelSelect",value:function(){this.currentComponentId=null,this.currentSchemaName=null,h.default.cancelSelectDone()}},{key:"getDropHolder",value:function(){var e=window.$(this.doc).find("#fengdie-components-drop-placeholder");return e.length||(e=window.$('<div id="fengdie-components-drop-placeholder" />'),e.html("\u6dfb\u52a0\u81f3\u6b64\u5904"),this.componentDropHolder=e),e.css({opacity:.5}),this.componentDropHolder}},{key:"showDropComponentPlaceHolder",value:function(e){var t,o=window.$(this.doc),n=this.getDropHolder();t=e.componentId?o.find("#".concat(m).concat(e.componentId)):window.$(".fengdie-components",o).children("[".concat(u,"]")).eq(e.index),t.length?"before"===e.type?t.before(n):t.after(n):window.$(".fengdie-components",o).html(n),n.animate({opacity:1},300),this.calcHeight()}},{key:"hideDropComponentPlaceHolder",value:function(){this.componentDropHolder&&this.componentDropHolder.remove(),this.showEmptyComponentTips(),this.componentDropHolder=null,this.calcHeight()}},{key:"render",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];"srcdoc"in this.iframe.get(0)?this.iframe.attr("srcdoc",e):(this.iframe.get(0).contentWindow.document.open(),this.iframe.get(0).contentWindow.document.write(e),this.iframe.get(0).contentWindow.document.close()),this.scrollTarget={needActiveSchema:i,componentId:n,schemaName:o},setTimeout(function(){t.loaded||t.iframeOnload()},3e3)}},{key:"initComponentList",value:function(){var e=[],t=window.$(".fengdie-components",this.doc);if(t.length){var o=t.children("[".concat(u,"]"));o.each(function(t,o){o=window.$(o),e.push({uid:o.attr("id").replace(m,""),name:o.data("ant-render-component"),meta:{top:o.offset().top,height:o.outerHeight()}})})}h.default.activeSelectedInitMM({componentList:e})}},{key:"doc",get:function(){return this.iframe.contents()}}]),e}(),v=function(e){function t(){return(0,d.default)(this,t),(0,a.default)(this,(0,c.default)(t).apply(this,arguments))}return(0,r.default)(t,e),(0,s.default)(t,[{key:"componentDidMount",value:function(){(new f).initPostMessage()}},{key:"render",value:function(){return l.default.createElement("div",{id:"sandbox-iframe-box"},l.default.createElement("iframe",{id:"viewer",width:"100%"}))}}]),t}(l.default.Component),g=v;t.default=g},h0yC:function(e,t,o){}}]);